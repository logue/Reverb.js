/**
 * @logue/reverb
 *
 * @description JavaScript Reverb effect class
 * @author Logue <logue@hotmail.co.jp>
 * @copyright 2019-2025 By Masashi Yoshikawa All rights reserved.
 * @license MIT
 * @version 1.4.1
 * @see {@link https://github.com/logue/Reverb.js}
 */

import{R as y}from"./Reverb-YS1-RCZA.js";const E=new URL(""+new URL("../demo.flac",import.meta.url).href,import.meta.url).href;document.getElementById("play").setAttribute("disabled","disabled");document.addEventListener("touchstart",m);function m(){document.removeEventListener("touchstart",m);const t=ctx.createBufferSource();t.start(),t.stop()}window.addEventListener("load",async()=>{const t=new window.AudioContext;document.addEventListener("touchstart",s);function s(){document.removeEventListener("touchstart",s);const e=t.createBufferSource();e.start(),e.stop()}const n=new y(t),d=t.createBufferSource(),v=async e=>new Promise(l=>{fetch(e).then(c=>c.arrayBuffer()).then(c=>t.decodeAudioData(c,o=>{document.getElementById("play").removeAttribute("disabled"),l(o)},o=>alert(o))).catch(c=>alert(c))}),i=t.createAnalyser(),a=document.getElementById("graph"),r=a.getContext("2d"),u=new Float32Array(1024),f=()=>{i.getFloatFrequencyData(u),r.fillStyle="#343a40",r.fillRect(0,0,a.width,a.height),r.fillStyle=document.getElementById("reverb").checked?"#17a2b8":"#28a745";for(let e=0;e<a.width;++e){t.sampleRate*e/(a.width*2);const l=a.height/2+(u[e]+48.16)*2.56;r.fillRect(e,a.height-l,1,l)}for(let e=-50;e<50;e+=10){const l=a.height/2-e*a.height/100|0;r.fillStyle="#6c757d",r.fillRect(20,l,a.width,1),r.fillStyle="#fd7e14",r.fillText(e+"dB",5,l)}r.fillStyle="#ffc107",r.fillRect(20,a.height/2,a.width,1);for(let e=2200;e<t.sampleRate/2;e+=2e3){const l=e*(a.width*2)/t.sampleRate|0;r.fillStyle="#6c757d",r.fillRect(l,0,1,a.height-10),l%4==0&&(r.fillStyle="#e83e8c",r.fillText(e/1e3+"kHz",l-10,a.height-1))}},g=()=>{d.disconnect(),document.getElementById("reverb").checked?n.connect(d).connect(i):n.disconnect(d).connect(i),i.connect(t.destination)},h=await v(E);setInterval(f,10),document.getElementById("play").addEventListener("click",e=>{e.target==e.currentTarget&&(d.buffer==null&&(d.buffer=h,d.loop=!0,g(),d.start()),t.state==="running"?t.suspend().then(()=>{e.target.innerHTML='<em class="bi bi-play"></em> Play'}):t.state==="suspended"&&t.resume().then(()=>{e.target.innerHTML='<em class="bi bi-pause"></em> Pause'}))},!1),document.getElementById("reverb").addEventListener("click",g),document.getElementById("reverse").addEventListener("click",e=>n.reverse(e.target.checked)),document.getElementById("time").addEventListener("change",e=>{n.time(e.target.value),e.target.title=e.target.value}),document.getElementById("decay").addEventListener("change",e=>{n.decay(e.target.value),e.target.title=e.target.value}),document.getElementById("delay").addEventListener("change",e=>{n.delay(e.target.value),e.target.title=e.target.value}),document.getElementById("filter").addEventListener("change",e=>{n.filterType(e.target.value),e.target.title=e.target.value}),document.getElementById("freq").addEventListener("change",e=>{n.filterFreq(e.target.value),e.target.title=e.target.value}),document.getElementById("q").addEventListener("change",e=>{n.filterQ(e.target.value),e.target.title=e.target.value}),document.getElementById("mix").addEventListener("change",e=>{n.mix(e.target.value),e.target.title=e.target.value}),document.querySelectorAll("[name=noise]").forEach(e=>e.addEventListener("click",l=>{document.getElementById("peaks").disabled=l.target.value==="white",n.setNoise(l.target.value)})),document.getElementById("peaks").addEventListener("change",e=>{n.peaks(e.target.value),e.target.title=e.target.value}),document.getElementById("scale").addEventListener("change",e=>{n.scale(e.target.value),e.target.title=e.target.value}),document.getElementById("randomAlgorithm").addEventListener("change",e=>{n.randomAlgorithm(e.target.value),e.target.title=e.target.value})});
